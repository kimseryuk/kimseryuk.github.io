<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>road to top</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no' />
  <link rel='stylesheet' href='css/reset.css'>
  <link rel='stylesheet' href='font/pretendard.css'>
  <link rel='stylesheet' href='font/pretendard-subset.css'>
  <link rel='stylesheet' href='css/style.css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>



  <!-- 부트스트랩 설정 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

</head>


<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Navbar</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">test</a>
        </li>
      </ul>
      
    </div>
  </nav>
  <div class="parents">
    <div class="content hero">
      <div class="background">
        <h2 data-aos="fade-up" data-aos-delay="100">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="200">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="300">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="400">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="500">we love salue</h2>
      </div>
    </div>
    <main>
      <div class="wrap">
        <div class="content">
          <section class="2022">
            <h2 class="section--title">2022</h2>
            <div class="history">
              <div class="history--list">
                <div id="list2022" class="list list2022" data-sheetName="test">
                </div>
              </div>
          </section>
        </div>
      </div>
      <div class="wrap autumn">
        <div class="content">
          <section class="2022">
            <h2 class="section--title">autumn</h2>
            <div class="history">
              <div class="history--list">
                <div id="list2022" class="list list2022" data-sheetName="test">
                </div>
              </div>
          </section>
        </div>
      </div>
      <!-- <div class="wrap">
        <div class="content">
          <section class="2022">
            <h2 class="section--title">2023</h2>
            <div class="history">
              <div class="history--list">
                <div id="list2023" class="list list2023" data-sheetName="2022">
                </div>
              </div>
          </section>
          <section class="2023">
            <h2 class="section--title">2023</h2>
            <div class="history">
              <div class="history--list">
                <div id="list2023" class="list list2023" data-sheetName="2023">
                </div>
              </div>
          </section>
          <section class="2024">
            <h2 class="section--title">2024</h2>
            <div class="history">
              <div class="history--list">
                <div id="list2024" class="list list2024" data-sheetName="2024">
                </div>
              </div>
          </section>
        </div>
      </div> -->
    </main>
  </div>
</body>

</div>
<script>
  window.onload = function() {
    //실행할 내용
    getSheetData()
  }


  const getSheetData = async () => {
    //깨끗하게 첨부터 시작해용
    $(".list").empty();
    //반복문 돌면서 연도별로 시트에 있는 값을 가져올것임
    for (let i = 0; i < $(".list").length; i++) {
      // const sheetId = '1yYM8BMK_WYqZwmSRCZ-K7WX776d9UcGpzZIOAVioGWk';
      const sheetId = "1du3WYKMQ9UODROfwEdrWjWSOUrjq798QTC38mmVfSCk"
      const base = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?`;
      const sheetName = $($('.list')[i]).attr('data-sheetName') //'리스트별 시트';
      const query = encodeURIComponent('Select *')
      const url = `${base}&sheet=${sheetName}&tq=${query}`

      const response = await fetch(url);
      let data = await response.text();
      let parsed = JSON.parse(data.substring(47).slice(0, -2))
      let cols = (parsed.table.cols).reduce((acc, cur) => {
        if (cur.label !== "") {
          acc.push(cur)
        }
        return acc
      }, [])

      let items = parsed.table.rows
        .map(({
          c
        }) => cleanRow(c))
        .map(function(t) {
          // console.log(t, parsed.table.cols);
          let returnObj = {}
          for (let i = 0; i < cols.length; i++) {
            returnObj[parsed.table.cols[i].label] = t[i]
          }
          return returnObj
        })
      // console.log(cols, items);
      setView(items, i)

      var innerHeight = $(".inner")
      // console.log(innerHeight)
    };

  }


  function cleanRow(row) {
    // row = [null,{v:'123'},null,{v:'hello'}]
    function replaceNull(item) {
      if (item == null) {
        return {
          v: ''
        }
      }
      return item
    }
    data = row
      .map((item) => replaceNull(item))
      .map((item) => item.v)
    return data
  }

  // users = getSheetData()
  // getSheetData.then(item => setView(item))
  // setView(users)
  function setView(users, index) {
    //let colSort = ($("#colSort").val()).split("	")
    let colSort = ("no	Date	News	Title	Body	Image	Link	Youtube	DiaryInstagram	DiaryGallery").split("	")
    for (let ii = 0; ii < users.length; ii++) {
      const e = users[ii];
      let str = "";
      for (let iii = 1; iii < colSort.length; iii++) {
        const element = colSort[iii];
        str += `<p>${colSort[iii]} : ${e[colSort[iii]]}</p>`
      }

      var counter = 0; // Initialize a counter for unique IDs

      var itemTemp = function(e) {
        counter++; // Increment counter for each item

        return `<div class="inner" id="inner-${counter}">
            <div class="group--now">
              <div class="circle">circle</div>
            </div>

            <div class="group--wrap">
              <div class="group group--main" data-aos="fade-up" data-aos-duration="1000">
                <div class="box box-text">
                  <p class="d_date">
                    ${e[colSort[1]]}
                  </p>
                  <div class="title">
                    <h3 class="title--main d_title">
                      ${e[colSort[3]]}
                    </h3>
                    <a href="${e[colSort[6]]}" class="title--desc d_news" target="_blank">${e[colSort[2]]}</a>
                    </div>
                    <p class="d_body">${e[colSort[4]]}</p>
                </div>
                <div class="box box-media" data-aos="fade-up" data-aos-delay="500" data-aos-duration="1000">
                  <img src="${e[colSort[5]]}" alt="" class="d_image">
                  <div class="group--instagram d_instagram">
                      ${e[colSort[8]]}
                   </div>
                </div>
              </div>
            </div>
          </div>`;
      };
      $($('.list')[index]).append($(itemTemp(e))); // Pass data (e) to the function

    }
  }

  AOS.init();

</script>

</html>