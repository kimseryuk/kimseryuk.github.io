<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>road to top</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no' />
  <link rel='stylesheet' href='css/reset.css'>
  <link rel='stylesheet' href='font/pretendard.css'>
  <link rel='stylesheet' href='font/pretendard-subset.css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <link rel='stylesheet' href='css/style.css'>

  <!-- 캐시사삭제 관련 -->
  <meta http-equiv="Expires" content="-1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <!-- 스크롤 이벤트 관련 -->
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>


  <!-- 부트스트랩 설정 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</head>


<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">road to top</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        <li class="nav-item active">
          <a class="nav-link" href="#scrollspyHeading1">2021</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#scrollspyHeading2">2022</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#scrollspyHeading3">2023</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#scrollspyHeading4">2024</a>
        </li>
      </ul>
      <a href="../">blog</a>
    </div>
    <div class="level">
      <div id="fixed_number" class="fixed">
        -
      </div>
    </div>
    <div class="progress-container">
      <div class="progress-bar"></div>
    </div>
  </nav>

  <div class="parents">
    <div class="content hero">
      <div class="background">
        <h2 data-aos="fade-up" data-aos-delay="100">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="200">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="300">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="400">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="500">we love salue</h2>
      </div>
    </div>
    <main data-bs-spy="scroll" data-bs-target="#navbar-example2" data-bs-offset="0" class="scrollspy-example" tabindex="0">
      <div class="wrap">
        <h2 id="scrollspyHeading1" class="section--title">2021</h2>
        <div id="list2021" class="list" data-sheetName="2021"></div>
      </div>
      <div class="wrap">
        <h2 id="scrollspyHeading2" class="section--title">2022</h2>
        <div id="list2021" class="list" data-sheetName="2022"></div>
      </div>
      <div class="wrap autumn">
        <div id="list2022A" class="list" data-sheetName="2022A"></div>
      </div>
      <div class="wrap">
        <div id="list2022W" class="list" data-sheetName="2022W"></div>
      </div>
      <div class="wrap">
        <h2 id="scrollspyHeading3" class="section--title">2023</h2>
        <div id="list2023" class="list" data-sheetName="2023"></div>
      </div>
      <div class="wrap autumn">
        <div id="list2023A" class="list" data-sheetName="2023A"></div>
      </div>
      <div class="wrap">
        <div id="list2023W" class="list" data-sheetName="2023W"></div>
      </div>
      <div class="wrap">
        <h2 id="scrollspyHeading4" class="section--title">2024</h2>
        <div id="list2024" class="list" data-sheetName="2024"></div>
      </div>
    </main>
    <!-- 뒷배경 -->
    <div class="mypic">
      <div id="fixed_img" class="fixed">
        -
      </div>
    </div>
  </div>

  <!-- 인스타 제거
     <div class="box--instagram d_instagram">
       ${e.Instagram}
     </div> -->
</body>

</div>
<script>
  window.onload = function() {
    //실행할 내용
    getSheetData()
  }



  const getSheetData = async () => {
    //깨끗하게 첨부터 시작해용
    $(".list").empty();
    //반복문 돌면서 연도별로 시트에 있는 값을 가져올것임
    for (let i = 0; i < $(".list").length; i++) {
      // const sheetId = '1yYM8BMK_WYqZwmSRCZ-K7WX776d9UcGpzZIOAVioGWk';
      const sheetId = "1du3WYKMQ9UODROfwEdrWjWSOUrjq798QTC38mmVfSCk"
      const base = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?`;
      const sheetName = $($('.list')[i]).attr('data-sheetName') //'리스트별 시트';
      const query = encodeURIComponent('Select *')
      const url = `${base}&sheet=${sheetName}&tq=${query}`

      const response = await fetch(url);
      let data = await response.text();
      let parsed = JSON.parse(data.substring(47).slice(0, -2))
      let cols = (parsed.table.cols).reduce((acc, cur) => {
        if (cur.label !== "") {
          acc.push(cur)
        }
        return acc
      }, [])

      let items = parsed.table.rows
        .map(({
          c
        }) => cleanRow(c))
        .map(function(t) {
          // console.log(t, parsed.table.cols);
          let returnObj = {}
          for (let i = 0; i < cols.length; i++) {
            returnObj[parsed.table.cols[i].label] = t[i]
          }
          return returnObj
        })
      // console.log(cols, items);
      setView(items, i)

      var innerHeight = $(".inner")
      // console.log(innerHeight)
    };

  }


  function cleanRow(row) {
    // row = [null,{v:'123'},null,{v:'hello'}]
    function replaceNull(item) {
      if (item == null) {
        return {
          v: ''
        }
      }
      return item
    }
    data = row
      .map((item) => replaceNull(item))
      .map((item) => item.v)
    return data
  }

  // users = getSheetData()
  // getSheetData.then(item => setView(item))
  // setView(users)
  function setView(users, index) {
    //let colSort = ($("#colSort").val()).split("	")
    let colSort = ("Important	no	Lank	Date	News	Writer	Title	Body	MainImage	SubImage	Link	Instagram	Kim").split("	")
    const filteredUsers = users.filter(user => user.Important === 1); // "Important"이 1인 사용자만 필터링

    for (let ii = 0; ii < filteredUsers.length; ii++) {
      const e = filteredUsers[ii];
      let str = "";
      for (let iii = 1; iii < colSort.length; iii++) {
        const element = colSort[iii];
        str += `<p>${colSort[iii]} : ${e[colSort[iii]]}</p>`
      }

      var counter = 0; // Initialize a counter for unique IDs

      var itemTemp = function(e) {
        counter++; // Increment counter for each item

        const imageHtml = e.MainImage ? `<div class="box--img"><img src="${e.MainImage}" alt="야구이미지" class="d_image" sizes="(max-width: 500px) 500px,(max-width: 800px) 600px,800px" style=""></div>` : ''; //이미지

        const imageHtml2 = e.SubImage ? `<div class="box--img"><img src="${e.SubImage}" alt="야구이미지" class="d_image" sizes="(max-width: 300px) 300px,(max-width: 300px) 300px,300px" style=""></div>` : ''; //이미지

        const NewsWriter = e.Writer ? `-${e.Writer}` : ''; //기사
        const linkNews = e.Link ? `<a href="${e.Link}" class="title--desc d_news" target="_blank">${e.News}${NewsWriter}</a>` : ''; //기사

        const badgeNo = e.no ? `<div class="memopill badge">${e.no}</div>` : ''; //메모


        return `<div class="inner" data="${e.Lank}">
        <div class="group--now">
          <div class="circle">circle</div>
          ${badgeNo}
        </div>

        <div class="group--wrap">
          <div class="group group--main" data-aos="fade-up" data-aos-duration="1000">
            <div class="title box">
              <p class="d_date">
                ${e.Date}
              </p>
              ${linkNews}
            </div>
            <h3 class="title--main d_title">
              ${e.Title}
            </h3>
            <p class="d_body">${e.Body}</p>
            ${imageHtml2}
          </div>
          <div class="group group--media" data-aos="fade-up" data-aos-delay="500" data-aos-duration="1000">
            ${imageHtml}
          </div>
        </div>
      </div>`;
      };

      $($('.list')[index]).append($(itemTemp(e))); // Pass data (e) to the function
      $('.memopill').each(function() {
      const text = $(this).text();
      // console.log(text)
      if (text === "UP" || text === "IN" ||text === "FA" ||text === "경기 시작") {
        $(this).addClass('red');
      } else if (text === "DOWN" ||text === "OUT" ||text === "매직넘버 소멸" ||text === "가을야구 끝") {
        $(this).addClass('blue');
      } else if (text === "TRADE") {
        $(this).addClass('green');
      } else if (text === "개막" ||text === "후반기" ||text === "전반기 종료" ||text === "후반기 시작") {
        $(this).addClass('orange');
      } else if (text === "NEWS") {
        $(this).addClass('purple');
      }
    });
    }
  }



  $(document).ready(function() {
    const progressBar = $('.progress-bar');
    const progressContainer = $('.progress-container');

    $(window).scroll(function() {
      const scrollTop = $(window).scrollTop();
      const documentHeight = $(document).height();
      const windowHeight = $(window).height();

      const scrollPercentage = (scrollTop / (documentHeight - windowHeight)) * 100;

      progressBar.css('width', `${scrollPercentage}%`);

      if (scrollPercentage === 100) {
        progressContainer.addClass('progress-complete');
      } else {
        progressContainer.removeClass('progress-complete');
      }
    });


  });
  


  AOS.init();


  $(window).scroll(function() {
    //네비 숨기기

    const scrollPosition = $(window).scrollTop();

    if (scrollPosition % 5 === 0) {
      const lastAnimatedElement = $(".group.aos-animate").last(); //js에서 넣어주는 class 명 마지막 친구 가져오기
      const parentClass = lastAnimatedElement.closest(".inner").attr("data") //제일 가까이에 있는 Inner의 데이터값 가져오기

      // console.log("Parent class of last animated element:", parentClass);

      $(".fixed").text(parentClass); //하단에 집어넣기

      if (parentClass == 0) {
        $(".fixed").text("stove league");
        $(".fixed").addClass("winter-class");
        $(".fixed").removeClass("autumn-class");
      } else if (parentClass == 11) {
        $(".fixed").text("WC");
        $(".fixed").removeClass("winter-class");
        $(".fixed").addClass("autumn-class");
      } else {
        $(".fixed").removeClass("winter-class");
        $(".fixed").removeClass("autumn-class");
      }
    }
    const list2024Top = $('#list2024').offset().top;
    const scrollTop = $(window).scrollTop();
    console.log("scrollTop",scrollTop,"list2024Top",list2024Top)
  
    if (scrollTop >= list2024Top) {
      $('#fixed_img').hide(200);
    } else if (scrollTop < list2024Top) {
      $('#fixed_img').show(200);
    }
  });

</script>


</html>