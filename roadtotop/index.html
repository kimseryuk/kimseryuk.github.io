<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>road to top</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no' />
  <link rel='stylesheet' href='css/reset.css'>
  <link rel='stylesheet' href='font/pretendard.css'>
  <link rel='stylesheet' href='font/pretendard-subset.css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <link rel='stylesheet' href='css/style.css'>

  <!-- 캐시사삭제 관련 -->
  <meta http-equiv="Expires" content="-1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <!-- 스크롤 이벤트 관련 -->
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>


  <!-- 부트스트랩 설정 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

</head>


<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="navbar-inner">
      <a class="navbar-brand" href="#">Navbar</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>

    <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">test</a>
        </li>
      </ul>
    </div>
    <div>
      <nav id="top">
        <div class="progressBarWrap">
          <span class="progressBar"></span>
        </div>
      </nav>

    </div>
  </nav>
  <div class="parents">
    <div class="content hero">
      <div class="background">
        <h2 data-aos="fade-up" data-aos-delay="100">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="200">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="300">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="400">we love salue</h2>
        <h2 data-aos="fade-up" data-aos-delay="500">we love salue</h2>
      </div>
    </div>
    <main>
      <div class="wrap">
        <h2 class="section--title">2021</h2>
        <div id="list2021" class="list" data-sheetName="2021"></div>
        <div class="wrap">
          <h2 class="section--title">2022</h2>
          <div id="list2021" class="list" data-sheetName="2022"></div>
        </div>
        <div class="wrap autumn">
          <div id="list2022A" class="list" data-sheetName="2022A"></div>
        </div>
        <div class="wrap">
          <div id="list2022W" class="list" data-sheetName="2022W"></div>
        </div>
        <div class="wrap">
          <h2 class="section--title">2023</h2>
          <div id="list2023" class="list" data-sheetName="2023"></div>
        </div>
        <div class="wrap autumn">
          <div id="list2023A" class="list" data-sheetName="2023A"></div>
        </div>
        <div class="wrap">
          <h2 class="section--title">2024</h2>
          <div id="list2024" class="list" data-sheetName="2024"></div>
        </div>
    </main>
    <div id="fixed_number" class="fixed">
      -
    </div>
  </div>
</body>

</div>
<script>
  window.onload = function() {
    //실행할 내용
    getSheetData()
  }


  const getSheetData = async () => {
    //깨끗하게 첨부터 시작해용
    $(".list").empty();
    //반복문 돌면서 연도별로 시트에 있는 값을 가져올것임
    for (let i = 0; i < $(".list").length; i++) {
      // const sheetId = '1yYM8BMK_WYqZwmSRCZ-K7WX776d9UcGpzZIOAVioGWk';
      const sheetId = "1du3WYKMQ9UODROfwEdrWjWSOUrjq798QTC38mmVfSCk"
      const base = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?`;
      const sheetName = $($('.list')[i]).attr('data-sheetName') //'리스트별 시트';
      const query = encodeURIComponent('Select *')
      const url = `${base}&sheet=${sheetName}&tq=${query}`

      const response = await fetch(url);
      let data = await response.text();
      let parsed = JSON.parse(data.substring(47).slice(0, -2))
      let cols = (parsed.table.cols).reduce((acc, cur) => {
        if (cur.label !== "") {
          acc.push(cur)
        }
        return acc
      }, [])

      let items = parsed.table.rows
        .map(({
          c
        }) => cleanRow(c))
        .map(function(t) {
          // console.log(t, parsed.table.cols);
          let returnObj = {}
          for (let i = 0; i < cols.length; i++) {
            returnObj[parsed.table.cols[i].label] = t[i]
          }
          return returnObj
        })
      // console.log(cols, items);
      setView(items, i)

      var innerHeight = $(".inner")
      // console.log(innerHeight)
    };

  }


  function cleanRow(row) {
    // row = [null,{v:'123'},null,{v:'hello'}]
    function replaceNull(item) {
      if (item == null) {
        return {
          v: ''
        }
      }
      return item
    }
    data = row
      .map((item) => replaceNull(item))
      .map((item) => item.v)
    return data
  }

  // users = getSheetData()
  // getSheetData.then(item => setView(item))
  // setView(users)
  function setView(users, index) {
    //let colSort = ($("#colSort").val()).split("	")
    let colSort = ("Important	no	Lank	Date	News	Writer	Title	Body	Image	Link	Instagram	Kim").split("	")
    const filteredUsers = users.filter(user => user.Important === 1); // "Important"이 1인 사용자만 필터링

    for (let ii = 0; ii < filteredUsers.length; ii++) {
      const e = filteredUsers[ii];
      let str = "";
      for (let iii = 1; iii < colSort.length; iii++) {
        const element = colSort[iii];
        str += `<p>${colSort[iii]} : ${e[colSort[iii]]}</p>`
      }

      var counter = 0; // Initialize a counter for unique IDs

      var itemTemp = function(e) {
        counter++; // Increment counter for each item

        return `<div class="inner inner-${e.Lank}" id="inner" data="${e.Lank}" >
            <div class="group--now">
              <div class="circle">circle</div>
            </div>

            <div class="group--wrap">
              <div class="group group--main" data-aos="fade-up" data-aos-duration="1000">
                <div class="box box-text">
                  <div class="title">
                  <p class="d_date">
                    ${e.Date}
                  </p>
                    <a href="${e.Link}" class="title--desc d_news" target="_blank">${e.News}</a>
                    </div>
                    <h3 class="title--main d_title">
                      ${e.Title}
                    </h3>
                    <p class="d_body">${e.Body}</p>
                    <img src="${e.Image}" alt="" class="d_image">
                </div>
                <div class="box box-media" data-aos="fade-up" data-aos-delay="500" data-aos-duration="1000">
                  <div class="group--instagram d_instagram">
                    ${e.Instagram}
                   </div>
                </div>
              </div>
            </div>
          </div>`;
      };

      $($('.list')[index]).append($(itemTemp(e))); // Pass data (e) to the function

    }
  }

  AOS.init();


  AOS.init({
    // AOS options (duration, easing, etc.)
  });

  $(window).scroll(function() {
    const scrollPosition = $(window).scrollTop();

    if (scrollPosition % 10 === 0) {
      const lastAnimatedElement = $(".group.aos-animate").last(); //js에서 넣어주는 class 명 마지막 친구 가져오기
      const parentClass = lastAnimatedElement.closest(".inner").attr("data") //제일 가까이에 있는 Inner의 데이터값 가져오기
      
      console.log("Parent class of last animated element:", parentClass);
      $("#fixed_number").text(parentClass); //하단에 집어넣기

      if (parentClass == 0) {
        $("#fixed_number").text("stoveleague");
        $("#fixed_number").addClass("winter-class");
        $("#fixed_number").removeClass("autumn-class");
      } else if (parentClass == 11){
        $("#fixed_number").text("WC");
        $("#fixed_number").removeClass("winter-class");
        $("#fixed_number").addClass("autumn-class");
      } else {
        $("#fixed_number").removeClass("winter-class");
        $("#fixed_number").removeClass("autumn-class");
      }
    }
  });
</script>


</html>